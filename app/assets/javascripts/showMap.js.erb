var mapConfig = {
  icon: L.icon({
    iconUrl: '<%= asset_path("marker-icon-2x.png") %>',
    shadowUrl: '<%= asset_path("marker-shadow.png") %>',
    iconSize:     [25, 41],
    shadowSize:   [41, 41],
    iconAnchor:   [12, 41],
    popupAnchor:  [1, -34]
  }),
  popupString: function(photo){
    return "<div class =\"popup-div\"><b>" + photo.name + "</b><br><img src=" + photo.link + " class=\"map-image\"></div>";
  },
  firstLocation: function(){
    return [locations.information[0].lat, locations.information[0].long];
  }
}

var generateMap = function(){
  var map = L.map('leafmap', {
    center: mapConfig.firstLocation(), //Initial geographical center of the map.
    zoom: 6, //Initial map zoom
    minZoom: 2, //Minimum zoom level of the map
    maxZoom: 13, //Maximum zoom level of the map
    maxBounds: L.latLngBounds([[-180, -180],[180, 180]]),
    // Interaction options
    worldCopyJump: true
  });

  L.tileLayer('https://{s}.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}',
   {
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
    maxZoom: 18,
    id: 'snags88.f17d4012',
    accessToken: 'pk.eyJ1Ijoic25hZ3M4OCIsImEiOiIyNHRGdHRzIn0.9kvD8k6z9Ib6j5H9NiuDBg',
    noWrap: true
  }).addTo(map);

  locations.information.each(function(){
    L.marker([this.lat, this.long], {icon:mapConfig.icon}).bindPopup(mapConfig.popupString(this)).addTo(map);
  });
}

var locations = {
  afterLoad: function(){
    this.getCoordinates();
  },
  getCoordinates: function(){
    this["information"] = $(".item-box img").map(function(){return $(this).data();})
  }
}


$(function(){
  $("#map-tab-button").on('click',function() {
   generateMap();
   $(this).off();
  });

  locations.afterLoad();
});

//Map State modifications
//setView( <LatLng> center,<Number> zoom?,<zoom/pan options> options? )
//setZoom( <Number> zoom, <zoom options> options? )
//panTo( <LatLng> latlng, <pan options> options? )
//openPopup( <String> html | <HTMLElement> el, <LatLng> latlng, <Popup options> options? )

//Markers
//L.marker( <LatLng> latlng,<Marker options> options? )

//MultiPolyLine
//draw path between multiple points given coordinates